(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))r(e);new MutationObserver(e=>{for(const t of e)if(t.type==="childList")for(const i of t.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&r(i)}).observe(document,{childList:!0,subtree:!0});function o(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?t.credentials="include":e.crossOrigin==="anonymous"?t.credentials="omit":t.credentials="same-origin",t}function r(e){if(e.ep)return;e.ep=!0;const t=o(e);fetch(e.href,t)}})();const p="http://localhost:3500",g=`${p}/goal`;async function f(){let o=new Date().toLocaleString().split(",")[0].split("/");return o[2]+"-"+(o[0].length===2?o[0]:"0"+o[0])+"-"+(o[1].length===2?o[1]:"0"+o[1])}const u=localStorage.getItem("accessToken");async function y(){if(!u||u==="")throw new Error("Access token not found");let a=await f();const n=await fetch(`${g}?date=${a}`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${u}`}});if(!n.ok)throw localStorage.clear(),new Error("Failed to fetch goals");return await n.json()}const m=p;async function w(a,n){const o=await fetch(`${m}/auth/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:a,password:n})});if(o.ok){const r=await o.json();return localStorage.setItem("accessToken",r==null?void 0:r.accessToken),r}else throw new Error("Failed to login")}async function E(a,n){const o=await fetch(`${m}/auth/register`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:a,password:n})});if(!o.ok)throw new Error("Failed to register");return await o.json()}async function L(){const a=await y();console.log(a),document.getElementById("app").innerHTML=JSON.stringify(a)}async function h(){const a=document.getElementById("app");a.innerHTML="";const n=document.createElement("main");n.id="auth-container";const o=document.createElement("h1"),r=document.createElement("form"),e=document.createElement("input");e.type="text",e.id="username-input",e.placeholder="username";const t=document.createElement("input");t.type="password",t.id="password-input",t.placeholder="password",e.required=!0,t.required=!0;const i=document.createElement("button");i.type="submit",i.textContent="Login",i.id="login-button",r.appendChild(e),r.appendChild(t),r.appendChild(i),r.addEventListener("submit",async d=>{d.preventDefault();try{const c=await w(e.value,t.value);console.log(c),window.location.reload()}catch(c){alert(c.message)}});const s=document.createElement("p");s.innerHTML="Don't have an account, register <a id='register-here'>here</a>",o.innerHTML="Login",n.appendChild(o),n.appendChild(r),n.appendChild(s),a.appendChild(n),document.getElementById("register-here").addEventListener("click",()=>{C()})}function C(){const a=document.getElementById("app");a.innerHTML="";const n=document.createElement("main");n.id="auth-container";const o=document.createElement("h1"),r=document.createElement("form"),e=document.createElement("input");e.type="text",e.id="username-input",e.placeholder="username";const t=document.createElement("input");t.type="password",t.id="password-input",t.placeholder="password";const i=document.createElement("input");i.type="password",i.id="password-input-confirm",i.placeholder="confirm password",e.required=!0,t.required=!0,i.required=!0;const s=document.createElement("button");s.type="submit",s.textContent="Register",s.id="login-button",r.appendChild(e),r.appendChild(t),r.appendChild(i),r.appendChild(s),r.addEventListener("submit",async c=>{c.preventDefault();try{if(i.value!==t.value){alert("Password does not match");return}const l=await E(e.value,t.value);console.log(l),alert("Registration successful"),window.location.reload()}catch(l){alert(l.message)}});const d=document.createElement("p");d.innerHTML="Have an account, login <a id='register-here'>here</a>",o.innerHTML="Register",n.appendChild(o),n.appendChild(r),n.appendChild(d),a.appendChild(n),document.getElementById("register-here").addEventListener("click",()=>{h()})}document.addEventListener("DOMContentLoaded",async()=>{try{await L()}catch{await h()}});
