(function(){const f=document.createElement("link").relList;if(f&&f.supports&&f.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))w(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const v of a.addedNodes)v.tagName==="LINK"&&v.rel==="modulepreload"&&w(v)}).observe(document,{childList:!0,subtree:!0});function O(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerPolicy&&(a.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?a.credentials="include":s.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function w(s){if(s.ep)return;s.ep=!0;const a=O(s);fetch(s.href,a)}})();document.addEventListener("DOMContentLoaded",async()=>{const L=document.getElementById("app"),f=document.getElementById("deleteListModal"),O=document.getElementById("confirmDelete"),w=document.getElementById("cancelDelete"),s=document.getElementById("contextMenu"),a=document.getElementById("deleteTodoModal"),v=document.getElementById("confirmDeleteTodo"),M=document.getElementById("cancelDeleteTodo"),E=document.getElementById("todoContextMenu"),y=" https://todobackend-re9d.onrender.com",n={username:null,lists:[],selectedList:null,todos:[],selectedTodo:null},B=async(e,t)=>{try{const o=await fetch(`${y}/auth/login`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({username:e,password:t})}),r=await o.json();o.ok?(console.log(r),n.username=r.username,$()):console.log("Login failed: ",r)}catch(o){console.error("Error during login: ",o)}},S=async()=>{try{const e=await fetch(`${y}/auth/logout`,{credentials:"include"}),t=await e.json();e.ok?console.log(t):console.error("Logout failed: ",e.message)}catch(e){console.error("Error during logout: ",e)}},N=async()=>{try{const e=await fetch(`${y}/list`,{credentials:"include"}),t=await e.json();return e.ok?(console.log(t),n.lists=t.lists,n.username=t.username,!0):(console.log("fetchin is failed: ",t),!1)}catch(e){return console.error("Error during fetchLists:",e),!1}},j=async()=>{try{const e=await fetch(`${y}/todo`,{credentials:"include"}),t=await e.json();return e.ok?(console.log(t),n.todos=t.todos,!0):(console.error("Error fetching todos:",t),!1)}catch(e){return console.error("Todo fetch error: ",e),!1}},q=()=>{L.innerHTML="",$()},P=()=>{L.innerHTML="";const e=document.createElement("form");e.addEventListener("submit",async t=>{t.preventDefault();const o=t.target.elements.username.value,r=t.target.elements.password.value;await B(o,r)}),e.innerHTML=`
            <h2>Нэвтрэх</h2>
            <label for="username">Хэрэглэгчийн нэр:</label>
            <input type="text" id="username" name="username" required>
            <label for="password">Нууц үг:</label>
            <input type="password" id="password" name="password" required>
            <button type="submit">нэвтрэх</button>
        `,L.appendChild(e)},$=async()=>{await N()&&await j()?(console.log(n.lists),console.log(n.todos),console.log("You are authenticated."),A()):(console.log("You are not authenticated. Login"),P())},A=async()=>{L.innerHTML="";const e=await U(),t=document.createElement("div");t.id="container";const o=await F(),r=await I(),u=await _();L.appendChild(e),t.appendChild(o),t.appendChild(r),t.appendChild(u),L.appendChild(t)},U=async()=>{const e=document.createElement("div");e.classList.add("header");const t=document.createElement("button");t.textContent="Гарах",e.appendChild(t),t.addEventListener("click",()=>S());const o=document.createElement("h2");return o.textContent=`За юу байна, хөөрхөнөө ${n.username}`,e.appendChild(o),e},F=async()=>{const e=document.createElement("div");e.id="lists";const t=document.createElement("h2");t.textContent="Жагсаалтууд",e.appendChild(t);const o=document.createElement("div");o.classList.add("single-list");const r=document.createElement("p");r.textContent="Өнөөдрийн төлөвлөгөө",o.appendChild(r),e.appendChild(o),o.addEventListener("click",async()=>{document.querySelectorAll(".single-list").forEach(c=>c.classList.remove("selected")),o.classList.add("selected"),n.selectedList="myDay",await x()});const u=document.createElement("div");u.classList.add("single-list");const m=document.createElement("p");m.textContent="Төлөвлөсөн",u.appendChild(m),e.appendChild(u),u.addEventListener("click",async()=>{document.querySelectorAll(".single-list").forEach(c=>c.classList.remove("selected")),u.classList.add("selected"),n.selectedList="planned",await x()});const p=document.createElement("div");p.classList.add("single-list");const C=document.createElement("p");if(C.textContent="Бүгд",p.appendChild(C),e.appendChild(p),p.addEventListener("click",async()=>{document.querySelectorAll(".single-list").forEach(c=>c.classList.remove("selected")),p.classList.add("selected"),n.selectedList="all",await x()}),e.appendChild(document.createElement("hr")),n.lists.length===0){const d=document.createElement("p");d.textContent="You have no lists created, buddy",e.appendChild(d)}else n.lists.map(d=>{const c=document.createElement("div");c.classList.add("single-list");const T=document.createElement("p");T.textContent=d.title,c.appendChild(T),e.appendChild(c),c.addEventListener("click",async()=>{document.querySelectorAll(".single-list").forEach(g=>g.classList.remove("selected")),c.classList.add("selected"),n.selectedList=d,await x()}),c.addEventListener("contextmenu",h=>{const g=d._id;H(h,g)})});const l=document.createElement("input"),i=document.createElement("button");return i.innerText="Нэмэх",e.appendChild(l),e.appendChild(i),i.addEventListener("click",async()=>{if(l.value==="")console.log("HOOSON BAINA");else try{const d=await fetch(`${y}/list`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({title:l.value.trim()})});if(d.ok){const c=await d.json();console.log("List created successfully:",c),window.location.reload()}else console.error("Failed to create list")}catch(d){console.error("Error creating list:",d)}}),e},H=(e,t)=>{e.preventDefault(),s.style.display="block",s.style.left=`${e.pageX}px`,s.style.top=`${e.pageY}px`,document.addEventListener("click",k),document.getElementById("deleteListOption").addEventListener("click",()=>{f.style.display="block",O.addEventListener("click",()=>{console.log(`List ${t} deleted`),Y(t),f.style.display="none",s.style.display="none",document.removeEventListener("click",k),window.location.reload()}),w.addEventListener("click",()=>{f.style.display="none",s.style.display="none",document.removeEventListener("click",k)})})},k=()=>{s.style.display="none",document.removeEventListener("click",k)},Y=async e=>{try{(await fetch(`${y}/list/${e}`,{method:"DELETE",headers:{"Content-Type":"application/json"},credentials:"include"})).ok?console.log(`List ${e} deleted successfully`):console.error(`Failed to delete ${e}`)}catch(t){console.error("Error deleting a list:",t)}},x=async()=>{let e;const t=new Date().toLocaleDateString(),o=document.getElementById("todos");o.innerHTML="";const r=document.createElement("div");r.classList="container";const u=document.createElement("form");u.id="addTodoForm";const m=document.createElement("input");m.type="text",m.id="todoTitle",m.name="todoTitle",m.required=!0;const p=document.createElement("input");p.type="date",p.id="todoDate",p.name="todoDate";const C=document.createElement("button");if(C.innerText="Let's Roll",C.type="submit",u.appendChild(m),u.appendChild(p),u.appendChild(C),r.appendChild(u),o.appendChild(r),u.addEventListener("submit",async l=>{l.preventDefault(),console.log(m.value.trim()),console.log(p.value);let i={};i.todoTitle=m.value.trim(),i.date=p.value,typeof n.selectedList!="string"&&(i.listId=n.selectedList.listId),(await fetch(`${y}/todo`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(i)})).ok?(console.log("Added todo"),window.location.reload()):console.log("Error adding todo")}),typeof n.selectedList=="string"?n.selectedList==="myDay"?e=n.todos.filter(l=>new Date(l.date).toLocaleDateString()===t):n.selectedList==="planned"?e=n.todos.filter(l=>l.date!==null):n.selectedList==="all"?e=n.todos:console.log("No list"):e=n.todos.filter(l=>(console.log(n.selectedList.listId),l.listId===n.selectedList.listId)),e.length!==0)e.forEach(l=>{const i=document.createElement("div");i.classList.add("single-todo");const d=document.createElement("div"),c=document.createElement("h4"),T=document.createElement("p");c.textContent=l.todoTitle,T.textContent=l.date;const h=document.createElement("input");h.type="checkbox",h.checked=l.completed===1,d.appendChild(T),d.appendChild(h),i.appendChild(c),i.appendChild(d),o.appendChild(i),i.addEventListener("contextmenu",g=>{const b=l._id;J(g,b)}),h.addEventListener("change",async()=>{const g=h.checked?1:0;try{(await fetch(`${y}/todo/${l.todoId}`,{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({completed:g})})).ok?console.log("PUT request successful"):console.error("PUT request failed")}catch(b){console.error("Error making PUT request:",b)}await I()})}),console.log(e);else{const l=document.createElement("p");l.textContent="Юм алгадаа хөгшөөн",o.appendChild(l),console.log("YOu have no todos, buddy")}},J=(e,t)=>{e.preventDefault(),E.style.display="block",E.style.left=`${e.pageX}px`,E.style.top=`${e.pageY}px`,document.addEventListener("click",D),document.getElementById("deleteTodoOption").addEventListener("click",()=>{a.style.display="block",v.addEventListener("click",()=>{console.log(`Todo ${t} deleted`),X(t),a.style.display="none",E.style.display="none",document.removeEventListener("click",D),window.location.reload()}),M.addEventListener("click",()=>{a.style.display="none",E.style.display="none",document.removeEventListener("click",D)})})},D=()=>{E.style.display="none",document.removeEventListener("click",D)},I=async()=>{const e=document.createElement("div");e.id="todos";const t=document.createElement("h2");return t.textContent="Хийх зүйлс",e.appendChild(t),e},X=async e=>{try{(await fetch(`${y}/todo/${e}`,{method:"DELETE",headers:{"Content-Type":"application/json"},credentials:"include"})).ok?console.log(`Todo ${e} deleted successfully`):console.error(`Failed to delete ${e}`)}catch(t){console.error("Error deleting a todo:",t)}},_=async()=>{const e=document.createElement("div");e.id="details";const t=document.createElement("h2");return t.textContent="Дэлгэрэнгүй",e.appendChild(t),e};q()});
