(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))n(e);new MutationObserver(e=>{for(const t of e)if(t.type==="childList")for(const a of t.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function i(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?t.credentials="include":e.crossOrigin==="anonymous"?t.credentials="omit":t.credentials="same-origin",t}function n(e){if(e.ep)return;e.ep=!0;const t=i(e);fetch(e.href,t)}})();const p="http://localhost:3500",f=`${p}/todo`,u=localStorage.getItem("accessToken");async function g(){if(!u||u==="")throw new Error("Access token not found");const r=await fetch(f,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${u}`}});if(!r.ok)throw localStorage.clear(),new Error("Failed to fetch todos");return await r.json()}const m=p;async function y(r,o){const i=await fetch(`${m}/auth/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:r,password:o})});if(i.ok){const n=await i.json();return localStorage.setItem("accessToken",n==null?void 0:n.accessToken),n}else throw new Error("Failed to login")}async function w(r,o){const i=await fetch(`${m}/auth/register`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:r,password:o})});if(!i.ok)throw new Error("Failed to register");return await i.json()}async function E(){const r=await g();console.log(r),document.getElementById("app").innerHTML=JSON.stringify(r)}async function h(){const r=document.getElementById("app");r.innerHTML="";const o=document.createElement("main");o.id="auth-container";const i=document.createElement("h1"),n=document.createElement("form"),e=document.createElement("input");e.type="text",e.id="username-input",e.placeholder="username";const t=document.createElement("input");t.type="password",t.id="password-input",t.placeholder="password",e.required=!0,t.required=!0;const a=document.createElement("button");a.type="submit",a.textContent="Login",a.id="login-button",n.appendChild(e),n.appendChild(t),n.appendChild(a),n.addEventListener("submit",async d=>{d.preventDefault();try{const c=await y(e.value,t.value);console.log(c),window.location.reload()}catch(c){alert(c.message)}});const s=document.createElement("p");s.innerHTML="Don't have an account, register <a id='register-here'>here</a>",i.innerHTML="Login",o.appendChild(i),o.appendChild(n),o.appendChild(s),r.appendChild(o),document.getElementById("register-here").addEventListener("click",()=>{L()})}function L(){const r=document.getElementById("app");r.innerHTML="";const o=document.createElement("main");o.id="auth-container";const i=document.createElement("h1"),n=document.createElement("form"),e=document.createElement("input");e.type="text",e.id="username-input",e.placeholder="username";const t=document.createElement("input");t.type="password",t.id="password-input",t.placeholder="password";const a=document.createElement("input");a.type="password",a.id="password-input-confirm",a.placeholder="confirm password",e.required=!0,t.required=!0,a.required=!0;const s=document.createElement("button");s.type="submit",s.textContent="Register",s.id="login-button",n.appendChild(e),n.appendChild(t),n.appendChild(a),n.appendChild(s),n.addEventListener("submit",async c=>{c.preventDefault();try{if(a.value!==t.value){alert("Password does not match");return}const l=await w(e.value,t.value);console.log(l),alert("Registration successful"),window.location.reload()}catch(l){alert(l.message)}});const d=document.createElement("p");d.innerHTML="Have an account, login <a id='register-here'>here</a>",i.innerHTML="Register",o.appendChild(i),o.appendChild(n),o.appendChild(d),r.appendChild(o),document.getElementById("register-here").addEventListener("click",()=>{h()})}document.addEventListener("DOMContentLoaded",async()=>{try{await E()}catch{await h()}});
