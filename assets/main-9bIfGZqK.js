(function(){const C=document.createElement("link").relList;if(C&&C.supports&&C.supports("modulepreload"))return;for(const d of document.querySelectorAll('link[rel="modulepreload"]'))x(d);new MutationObserver(d=>{for(const m of d)if(m.type==="childList")for(const w of m.addedNodes)w.tagName==="LINK"&&w.rel==="modulepreload"&&x(w)}).observe(document,{childList:!0,subtree:!0});function O(d){const m={};return d.integrity&&(m.integrity=d.integrity),d.referrerPolicy&&(m.referrerPolicy=d.referrerPolicy),d.crossOrigin==="use-credentials"?m.credentials="include":d.crossOrigin==="anonymous"?m.credentials="omit":m.credentials="same-origin",m}function x(d){if(d.ep)return;d.ep=!0;const m=O(d);fetch(d.href,m)}})();document.addEventListener("DOMContentLoaded",async()=>{const v=document.getElementById("app"),C=document.getElementById("deleteListModal"),O=document.getElementById("confirmDelete"),x=document.getElementById("cancelDelete"),d=document.getElementById("contextMenu"),m=document.getElementById("deleteTodoModal"),w=document.getElementById("confirmDeleteTodo"),B=document.getElementById("cancelDeleteTodo"),T=document.getElementById("todoContextMenu"),E="https://todobackend-re9d.onrender.com",s={username:null,lists:[],selectedList:null,todos:[],selectedTodo:null},M=async(e,t)=>{try{const n=await fetch(`${E}/auth/login`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({username:e,password:t})}),p=await n.json();n.ok?(console.log(p),s.username=p.username,$()):console.log("Login failed: ",p)}catch(n){console.error("Error during login: ",n)}},S=async()=>{try{const e=await fetch(`${E}/auth/logout`,{credentials:"include"}),t=await e.json();e.ok?console.log(t):console.error("Logout failed: ",e.message)}catch(e){console.error("Error during logout: ",e)}},N=async()=>{try{const e=await fetch(`${E}/list`,{credentials:"include"}),t=await e.json();return e.ok?(console.log(t),s.lists=t.lists,s.username=t.username,!0):(console.log("fetchin is failed: ",t),!1)}catch(e){return console.error("Error during fetchLists:",e),!1}},j=async()=>{try{const e=await fetch(`${E}/todo`,{credentials:"include"}),t=await e.json();return e.ok?(console.log(t),s.todos=t.todos,!0):(console.error("Error fetching todos:",t),!1)}catch(e){return console.error("Todo fetch error: ",e),!1}},q=()=>{v.innerHTML="",$()},A=()=>{v.innerHTML="";const e=document.createElement("form");e.addEventListener("submit",async t=>{t.preventDefault();const n=t.target.elements.username.value,p=t.target.elements.password.value;await M(n,p)}),e.innerHTML=`
            <h2>Нэвтрэх</h2>
            <label for="username">Хэрэглэгчийн нэр:</label>
            <input type="text" id="username" name="username" required>
            <label for="password">Нууц үг:</label>
            <input type="password" id="password" name="password" required>
            <button type="submit">нэвтрэх</button>
        `,v.appendChild(e)},$=async()=>{await N()&&await j()?(console.log(s.lists),console.log(s.todos),console.log("You are authenticated."),P()):(console.log("You are not authenticated. Login"),A())},P=async()=>{v.innerHTML="";const e=await H(),t=document.createElement("div");t.id="container";const n=await F(),p=await I(),i=await K();v.appendChild(e),t.appendChild(n),t.appendChild(p),t.appendChild(i),v.appendChild(t)},H=async()=>{const e=document.createElement("div");e.classList.add("header");const t=document.createElement("button");t.textContent="Гарах",e.appendChild(t),t.addEventListener("click",()=>S());const n=document.createElement("h2");return n.textContent=`За юу байна, хөөрхөнөө ${s.username}`,e.appendChild(n),e},F=async()=>{const e=document.createElement("div");e.id="lists";const t=document.createElement("h2");t.textContent="Жагсаалтууд",e.appendChild(t);const n=document.createElement("div");n.classList.add("single-list");const p=document.createElement("p");p.textContent="Өнөөдрийн төлөвлөгөө",n.appendChild(p),e.appendChild(n),n.addEventListener("click",async()=>{document.querySelectorAll(".single-list").forEach(l=>l.classList.remove("selected")),n.classList.add("selected"),s.selectedList="myDay",await D()});const i=document.createElement("div");i.classList.add("single-list");const r=document.createElement("p");r.textContent="Төлөвлөсөн",i.appendChild(r),e.appendChild(i),i.addEventListener("click",async()=>{document.querySelectorAll(".single-list").forEach(l=>l.classList.remove("selected")),i.classList.add("selected"),s.selectedList="planned",await D()});const u=document.createElement("div");u.classList.add("single-list");const L=document.createElement("p");if(L.textContent="Бүгд",u.appendChild(L),e.appendChild(u),u.addEventListener("click",async()=>{document.querySelectorAll(".single-list").forEach(l=>l.classList.remove("selected")),u.classList.add("selected"),s.selectedList="all",await D()}),e.appendChild(document.createElement("hr")),s.lists.length===0){const a=document.createElement("p");a.textContent="You have no lists created, buddy",e.appendChild(a)}else s.lists.map(a=>{const l=document.createElement("div");l.classList.add("single-list");const f=document.createElement("p");f.textContent=a.title,l.appendChild(f),e.appendChild(l),l.addEventListener("click",async()=>{document.querySelectorAll(".single-list").forEach(h=>h.classList.remove("selected")),l.classList.add("selected"),s.selectedList=a,await D()}),l.addEventListener("contextmenu",y=>{const h=a._id;U(y,h)})});const o=document.createElement("input"),c=document.createElement("button");return c.innerText="Нэмэх",e.appendChild(o),e.appendChild(c),c.addEventListener("click",async()=>{if(o.value==="")console.log("HOOSON BAINA");else try{const a=await fetch(`${E}/list`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({title:o.value.trim()})});if(a.ok){const l=await a.json();console.log("List created successfully:",l),window.location.reload()}else console.error("Failed to create list")}catch(a){console.error("Error creating list:",a)}}),e},U=(e,t)=>{e.preventDefault(),d.style.display="block",d.style.left=`${e.pageX}px`,d.style.top=`${e.pageY}px`,document.addEventListener("click",k),document.getElementById("deleteListOption").addEventListener("click",()=>{C.style.display="block",O.addEventListener("click",()=>{console.log(`List ${t} deleted`),Y(t),C.style.display="none",d.style.display="none",document.removeEventListener("click",k),window.location.reload()}),x.addEventListener("click",()=>{C.style.display="none",d.style.display="none",document.removeEventListener("click",k)})})},k=()=>{d.style.display="none",document.removeEventListener("click",k)},Y=async e=>{try{(await fetch(`${E}/list/${e}`,{method:"DELETE",headers:{"Content-Type":"application/json"},credentials:"include"})).ok?console.log(`List ${e} deleted successfully`):console.error(`Failed to delete ${e}`)}catch(t){console.error("Error deleting a list:",t)}},D=async()=>{let e;const t=new Date().toLocaleDateString(),n=document.getElementById("todos");n.innerHTML="";const p=document.createElement("div");p.classList="container";const i=document.createElement("form");i.id="addTodoForm";const r=document.createElement("input");r.type="text",r.id="todoTitle",r.name="todoTitle",r.required=!0;const u=document.createElement("input");u.type="date",u.id="todoDate",u.name="todoDate";const L=document.createElement("button");if(L.innerText="Let's Roll",L.type="submit",i.appendChild(r),i.appendChild(u),i.appendChild(L),p.appendChild(i),n.appendChild(p),i.addEventListener("submit",async o=>{o.preventDefault(),console.log(r.value.trim()),console.log(u.value);let c={};c.todoTitle=r.value.trim(),c.date=u.value,typeof s.selectedList!="string"&&(c.listId=s.selectedList.listId),(await fetch(`${E}/todo`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(c)})).ok?(console.log("Added todo"),window.location.reload()):console.log("Error adding todo")}),typeof s.selectedList=="string"?s.selectedList==="myDay"?e=s.todos.filter(o=>new Date(o.date).toLocaleDateString()===t):s.selectedList==="planned"?e=s.todos.filter(o=>o.date!==null):s.selectedList==="all"?e=s.todos:console.log("No list"):e=s.todos.filter(o=>(console.log(s.selectedList.listId),o.listId===s.selectedList.listId)),e.length!==0)e.forEach(o=>{const c=document.createElement("div");c.classList.add("single-todo");const a=document.createElement("div"),l=document.createElement("h4"),f=document.createElement("p");l.textContent=o.todoTitle,f.textContent=o.date;const y=document.createElement("input");y.type="checkbox",y.checked=o.completed,a.appendChild(f),a.appendChild(y),c.appendChild(l),c.appendChild(a),n.appendChild(c),c.addEventListener("click",async()=>await X(o)),c.addEventListener("contextmenu",h=>{const g=o._id;J(h,g)}),y.addEventListener("change",async()=>{const h=!o.completed;console.log(h);try{const g=await fetch(`${E}/todo/completed/${o._id}`,{credentials:"include"});g.ok?(console.log(g),window.location.reload()):console.error("PUT request failed")}catch(g){console.error("Error making PUT request:",g)}await I()})}),console.log(e);else{const o=document.createElement("p");o.textContent="Юм алгадаа хөгшөөн",n.appendChild(o),console.log("YOu have no todos, buddy")}},J=(e,t)=>{e.preventDefault(),T.style.display="block",T.style.left=`${e.pageX}px`,T.style.top=`${e.pageY}px`,document.addEventListener("click",b),document.getElementById("deleteTodoOption").addEventListener("click",()=>{m.style.display="block",w.addEventListener("click",()=>{console.log(`Todo ${t} deleted`),_(t),m.style.display="none",T.style.display="none",document.removeEventListener("click",b),window.location.reload()}),B.addEventListener("click",()=>{m.style.display="none",T.style.display="none",document.removeEventListener("click",b)})})},b=()=>{T.style.display="none",document.removeEventListener("click",b)},I=async()=>{const e=document.createElement("div");e.id="todos";const t=document.createElement("h2");return t.textContent="Хийх зүйлс",e.appendChild(t),e},_=async e=>{try{(await fetch(`${E}/todo/${e}`,{method:"DELETE",headers:{"Content-Type":"application/json"},credentials:"include"})).ok?console.log(`Todo ${e} deleted successfully`):console.error(`Failed to delete ${e}`)}catch(t){console.error("Error deleting a todo:",t)}},X=async e=>{const t=document.getElementById("details");t.innerHTML="",console.log(t),console.log(e);let n=e.todoTitle,p=e._id,i=e.completed,r=e.date;console.log(r),r=r.split("T")[0];let u=e.description;const L=document.createElement("h3");L.textContent="Title";const o=document.createElement("textarea");o.id="title-text-area";const c=document.createElement("input");c.type="date";const a=document.createElement("h4");a.textContent="Completed";const l=document.createElement("input");l.type="checkbox";const f=document.createElement("h4");f.textContent="Description";const y=document.createElement("textarea");y.id="desc-text-area";const h=document.createElement("button");h.textContent="Save",o.value=n,c.value=r,l.checked=!!i,y.value=u,t.appendChild(L),t.appendChild(o),t.appendChild(c),t.appendChild(a),t.appendChild(l),t.appendChild(f),t.appendChild(y),t.appendChild(h),o.addEventListener("change",async()=>{n=o.value,console.log(n)}),c.addEventListener("change",async()=>{r=c.value,console.log(r)}),l.addEventListener("change",async()=>{i=l.checked,console.log(i)}),y.addEventListener("change",async()=>{u=y.value,console.log(u)}),h.addEventListener("click",async()=>{n||alert("Todo should have title");const g=await fetch(`${E}/todo/${p}`,{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({todoTitle:n,date:r,completed:i,description:u})});g.ok?(console.log(g.json()),window.location.reload()):console.log(g.json())})},K=async()=>{const e=document.createElement("div");e.id="details";const t=document.createElement("h2");return t.textContent="Дэлгэрэнгүй",e.appendChild(t),e};q()});
