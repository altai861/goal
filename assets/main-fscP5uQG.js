(function(){const C=document.createElement("link").relList;if(C&&C.supports&&C.supports("modulepreload"))return;for(const c of document.querySelectorAll('link[rel="modulepreload"]'))x(c);new MutationObserver(c=>{for(const m of c)if(m.type==="childList")for(const w of m.addedNodes)w.tagName==="LINK"&&w.rel==="modulepreload"&&x(w)}).observe(document,{childList:!0,subtree:!0});function I(c){const m={};return c.integrity&&(m.integrity=c.integrity),c.referrerPolicy&&(m.referrerPolicy=c.referrerPolicy),c.crossOrigin==="use-credentials"?m.credentials="include":c.crossOrigin==="anonymous"?m.credentials="omit":m.credentials="same-origin",m}function x(c){if(c.ep)return;c.ep=!0;const m=I(c);fetch(c.href,m)}})();document.addEventListener("DOMContentLoaded",async()=>{const v=document.getElementById("app"),C=document.getElementById("deleteListModal"),I=document.getElementById("confirmDelete"),x=document.getElementById("cancelDelete"),c=document.getElementById("contextMenu"),m=document.getElementById("deleteTodoModal"),w=document.getElementById("confirmDeleteTodo"),$=document.getElementById("cancelDeleteTodo"),T=document.getElementById("todoContextMenu"),g="https://todobackend-re9d.onrender.com",s={username:null,lists:[],selectedList:null,todos:[],selectedTodo:null},M=async(e,t)=>{try{const n=await fetch(`${g}/auth/login`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({username:e,password:t})}),p=await n.json();n.ok?(console.log(p),s.username=p.username,B()):console.log("Login failed: ",p)}catch(n){console.error("Error during login: ",n)}},S=async()=>{try{const e=await fetch(`${g}/auth/logout`,{method:"GET",credentials:"include",headers:{"Content-Type":"application/json"}});e.ok?console.log("Logged out successfully"):console.error("Logout failed:",e.statusText)}catch(e){console.error("Error during logout:",e)}},N=async()=>{try{const e=await fetch(`${g}/list`,{credentials:"include"}),t=await e.json();return e.ok?(console.log(t),s.lists=t.lists,s.username=t.username,!0):(console.log("fetchin is failed: ",t),!1)}catch(e){return console.error("Error during fetchLists:",e),!1}},j=async()=>{try{const e=await fetch(`${g}/todo`,{credentials:"include"}),t=await e.json();return e.ok?(console.log(t),s.todos=t.todos,!0):(console.error("Error fetching todos:",t),!1)}catch(e){return console.error("Todo fetch error: ",e),!1}},q=()=>{v.innerHTML="",B()},A=()=>{v.innerHTML="";const e=document.createElement("form");e.addEventListener("submit",async t=>{t.preventDefault();const n=t.target.elements.username.value,p=t.target.elements.password.value;await M(n,p)}),e.innerHTML=`
            <h2>Нэвтрэх</h2>
            <label for="username">Хэрэглэгчийн нэр:</label>
            <input type="text" id="username" name="username" required>
            <label for="password">Нууц үг:</label>
            <input type="password" id="password" name="password" required>
            <button type="submit">нэвтрэх</button>
        `,v.appendChild(e)},B=async()=>{document.getElementById("loading").style.display="block",await N()&&await j()?(console.log(s.lists),console.log(s.todos),console.log("You are authenticated."),document.getElementById("loading").style.display="none",P()):(console.log("You are not authenticated. Login"),document.getElementById("loading").style.display="none",A())},P=async()=>{v.innerHTML="";const e=await H(),t=document.createElement("div");t.id="container";const n=await F(),p=await O(),l=await G();v.appendChild(e),t.appendChild(n),t.appendChild(p),t.appendChild(l),v.appendChild(t)},H=async()=>{const e=document.createElement("div");e.classList.add("header");const t=document.createElement("div");t.id="left-corner-header-side";const n=document.createElement("button");n.textContent="Гарах",n.addEventListener("click",()=>S());const p=document.createElement("h2");p.textContent=`За юу байна, хөөрхөнөө ${s.username}`,t.appendChild(n),t.appendChild(p),e.appendChild(t);const l=document.createElement("div");l.id="right-side-header";const a=document.createElement("input");return a.id="search-bar",a.placeholder="Хайх...",l.appendChild(a),e.appendChild(l),e},F=async()=>{const e=document.createElement("div");e.id="lists";const t=document.createElement("h2");t.textContent="Жагсаалтууд",e.appendChild(t);const n=document.createElement("div");n.classList.add("single-list");const p=document.createElement("p");p.textContent="Өнөөдрийн төлөвлөгөө",n.appendChild(p),e.appendChild(n),n.addEventListener("click",async()=>{document.querySelectorAll(".single-list").forEach(d=>d.classList.remove("selected")),n.classList.add("selected"),s.selectedList="myDay",await D()});const l=document.createElement("div");l.classList.add("single-list");const a=document.createElement("p");a.textContent="Төлөвлөсөн",l.appendChild(a),e.appendChild(l),l.addEventListener("click",async()=>{document.querySelectorAll(".single-list").forEach(d=>d.classList.remove("selected")),l.classList.add("selected"),s.selectedList="planned",await D()});const u=document.createElement("div");u.classList.add("single-list");const L=document.createElement("p");if(L.textContent="Бүгд",u.appendChild(L),e.appendChild(u),u.addEventListener("click",async()=>{document.querySelectorAll(".single-list").forEach(d=>d.classList.remove("selected")),u.classList.add("selected"),s.selectedList="all",await D()}),e.appendChild(document.createElement("hr")),s.lists.length===0){const r=document.createElement("p");r.textContent="You have no lists created, buddy",e.appendChild(r)}else s.lists.map(r=>{const d=document.createElement("div");d.classList.add("single-list");const f=document.createElement("p");f.textContent=r.title,d.appendChild(f),e.appendChild(d),d.addEventListener("click",async()=>{document.querySelectorAll(".single-list").forEach(h=>h.classList.remove("selected")),d.classList.add("selected"),s.selectedList=r,await D()}),d.addEventListener("contextmenu",y=>{const h=r._id;U(y,h)})});const o=document.createElement("input"),i=document.createElement("button");return i.innerText="Нэмэх",e.appendChild(o),e.appendChild(i),i.addEventListener("click",async()=>{if(o.value==="")console.log("HOOSON BAINA");else try{const r=await fetch(`${g}/list`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({title:o.value.trim()})});if(r.ok){const d=await r.json();console.log("List created successfully:",d),window.location.reload()}else console.error("Failed to create list")}catch(r){console.error("Error creating list:",r)}}),e},U=(e,t)=>{e.preventDefault(),c.style.display="block",c.style.left=`${e.pageX}px`,c.style.top=`${e.pageY}px`,document.addEventListener("click",k),document.getElementById("deleteListOption").addEventListener("click",()=>{C.style.display="block",I.addEventListener("click",()=>{console.log(`List ${t} deleted`),Y(t),C.style.display="none",c.style.display="none",document.removeEventListener("click",k),window.location.reload()}),x.addEventListener("click",()=>{C.style.display="none",c.style.display="none",document.removeEventListener("click",k)})})},k=()=>{c.style.display="none",document.removeEventListener("click",k)},Y=async e=>{try{(await fetch(`${g}/list/${e}`,{method:"DELETE",headers:{"Content-Type":"application/json"},credentials:"include"})).ok?console.log(`List ${e} deleted successfully`):console.error(`Failed to delete ${e}`)}catch(t){console.error("Error deleting a list:",t)}},D=async()=>{let e;const t=new Date().toLocaleDateString(),n=document.getElementById("todos");n.innerHTML="";const p=document.createElement("div");p.classList="container";const l=document.createElement("form");l.id="addTodoForm";const a=document.createElement("input");a.type="text",a.id="todoTitle",a.name="todoTitle",a.required=!0;const u=document.createElement("input");u.type="date",u.id="todoDate",u.name="todoDate";const L=document.createElement("button");if(L.innerText="Let's Roll",L.type="submit",l.appendChild(a),l.appendChild(u),l.appendChild(L),p.appendChild(l),n.appendChild(p),l.addEventListener("submit",async o=>{o.preventDefault(),console.log(a.value.trim()),console.log(u.value);let i={};i.todoTitle=a.value.trim(),i.date=u.value,typeof s.selectedList!="string"&&(i.listId=s.selectedList.listId),(await fetch(`${g}/todo`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(i)})).ok?(console.log("Added todo"),window.location.reload()):console.log("Error adding todo")}),typeof s.selectedList=="string"?s.selectedList==="myDay"?e=s.todos.filter(o=>new Date(o.date).toLocaleDateString()===t):s.selectedList==="planned"?e=s.todos.filter(o=>o.date!==null):s.selectedList==="all"?e=s.todos:console.log("No list"):e=s.todos.filter(o=>(console.log(s.selectedList.listId),o.listId===s.selectedList.listId)),e.length!==0)e.forEach(o=>{const i=document.createElement("div");i.classList.add("single-todo");const r=document.createElement("div"),d=document.createElement("h4"),f=document.createElement("p");d.textContent=o.todoTitle,f.textContent=o.date;const y=document.createElement("input");y.type="checkbox",y.checked=o.completed,r.appendChild(f),r.appendChild(y),i.appendChild(d),i.appendChild(r),n.appendChild(i),i.addEventListener("click",async()=>await X(o)),i.addEventListener("contextmenu",h=>{const E=o._id;J(h,E)}),y.addEventListener("change",async()=>{const h=!o.completed;console.log(h);try{const E=await fetch(`${g}/todo/completed/${o._id}`,{credentials:"include"});E.ok?(console.log(E),window.location.reload()):console.error("PUT request failed")}catch(E){console.error("Error making PUT request:",E)}await O()})}),console.log(e);else{const o=document.createElement("p");o.textContent="Юм алгадаа хөгшөөн",n.appendChild(o),console.log("YOu have no todos, buddy")}},J=(e,t)=>{e.preventDefault(),T.style.display="block",T.style.left=`${e.pageX}px`,T.style.top=`${e.pageY}px`,document.addEventListener("click",b),document.getElementById("deleteTodoOption").addEventListener("click",()=>{m.style.display="block",w.addEventListener("click",()=>{console.log(`Todo ${t} deleted`),_(t),m.style.display="none",T.style.display="none",document.removeEventListener("click",b),window.location.reload()}),$.addEventListener("click",()=>{m.style.display="none",T.style.display="none",document.removeEventListener("click",b)})})},b=()=>{T.style.display="none",document.removeEventListener("click",b)},O=async()=>{const e=document.createElement("div");e.id="todos";const t=document.createElement("h2");return t.textContent="Хийх зүйлс",e.appendChild(t),e},_=async e=>{try{(await fetch(`${g}/todo/${e}`,{method:"DELETE",headers:{"Content-Type":"application/json"},credentials:"include"})).ok?console.log(`Todo ${e} deleted successfully`):console.error(`Failed to delete ${e}`)}catch(t){console.error("Error deleting a todo:",t)}},X=async e=>{const t=document.getElementById("details");t.innerHTML="",console.log(t),console.log(e);let n=e.todoTitle,p=e._id,l=e.completed,a=e.date;console.log(a),a=a.split("T")[0];let u=e.description;const L=document.createElement("h3");L.textContent="Title";const o=document.createElement("textarea");o.id="title-text-area";const i=document.createElement("input");i.type="date";const r=document.createElement("h4");r.textContent="Completed";const d=document.createElement("input");d.type="checkbox";const f=document.createElement("h4");f.textContent="Description";const y=document.createElement("textarea");y.id="desc-text-area";const h=document.createElement("button");h.textContent="Save",o.value=n,i.value=a,d.checked=!!l,y.value=u,t.appendChild(L),t.appendChild(o),t.appendChild(i),t.appendChild(r),t.appendChild(d),t.appendChild(f),t.appendChild(y),t.appendChild(h),o.addEventListener("change",async()=>{n=o.value,console.log(n)}),i.addEventListener("change",async()=>{a=i.value,console.log(a)}),d.addEventListener("change",async()=>{l=d.checked,console.log(l)}),y.addEventListener("change",async()=>{u=y.value,console.log(u)}),h.addEventListener("click",async()=>{n||alert("Todo should have title");const E=await fetch(`${g}/todo/${p}`,{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({todoTitle:n,date:a,completed:l,description:u})});E.ok?(console.log(E.json()),window.location.reload()):console.log(E.json())})},G=async()=>{const e=document.createElement("div");e.id="details";const t=document.createElement("h2");return t.textContent="Дэлгэрэнгүй",e.appendChild(t),e};q()});
