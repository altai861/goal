(function(){const L=document.createElement("link").relList;if(L&&L.supports&&L.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))k(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const T of a.addedNodes)T.tagName==="LINK"&&T.rel==="modulepreload"&&k(T)}).observe(document,{childList:!0,subtree:!0});function O(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerPolicy&&(a.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?a.credentials="include":s.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function k(s){if(s.ep)return;s.ep=!0;const a=O(s);fetch(s.href,a)}})();document.addEventListener("DOMContentLoaded",async()=>{const h=document.getElementById("app"),L=document.getElementById("deleteListModal"),O=document.getElementById("confirmDelete"),k=document.getElementById("cancelDelete"),s=document.getElementById("contextMenu"),a=document.getElementById("deleteTodoModal"),T=document.getElementById("confirmDeleteTodo"),B=document.getElementById("cancelDeleteTodo"),E=document.getElementById("todoContextMenu"),y="https://todobackend-re9d.onrender.com",n={username:null,lists:[],selectedList:null,todos:[],selectedTodo:null},I=async(e,t)=>{try{const o=await fetch(`${y}/auth/login`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({username:e,password:t})}),r=await o.json();o.ok?(console.log(r),n.username=r.username,$()):console.log("Login failed: ",r)}catch(o){console.error("Error during login: ",o)}},S=async()=>{try{const e=await fetch(`${y}/auth/logout`,{credentials:"include"}),t=await e.json();e.ok?console.log(t):console.error("Logout failed: ",e.message)}catch(e){console.error("Error during logout: ",e)}},N=async()=>{try{const e=await fetch(`${y}/list`,{credentials:"include"}),t=await e.json();return e.ok?(console.log(t),n.lists=t.lists,n.username=t.username,!0):(console.log("fetchin is failed: ",t),!1)}catch(e){return console.error("Error during fetchLists:",e),!1}},j=async()=>{try{const e=await fetch(`${y}/todo`,{credentials:"include"}),t=await e.json();return e.ok?(console.log(t),n.todos=t.todos,!0):(console.error("Error fetching todos:",t),!1)}catch(e){return console.error("Todo fetch error: ",e),!1}},q=()=>{h.innerHTML="",$()},A=()=>{h.innerHTML="";const e=document.createElement("form");e.addEventListener("submit",async t=>{t.preventDefault();const o=t.target.elements.username.value,r=t.target.elements.password.value;await I(o,r)}),e.innerHTML=`
            <h2>Нэвтрэх</h2>
            <label for="username">Хэрэглэгчийн нэр:</label>
            <input type="text" id="username" name="username" required>
            <label for="password">Нууц үг:</label>
            <input type="password" id="password" name="password" required>
            <button type="submit">нэвтрэх</button>
        `,h.appendChild(e)},$=async()=>{await N()&&await j()?(console.log(n.lists),console.log(n.todos),console.log("You are authenticated."),P()):(console.log("You are not authenticated. Login"),A())},P=async()=>{h.innerHTML="";const e=await F(),t=document.createElement("div");t.id="container";const o=await H(),r=await M(),u=await X();h.appendChild(e),t.appendChild(o),t.appendChild(r),t.appendChild(u),h.appendChild(t)},F=async()=>{const e=document.createElement("div");e.classList.add("header");const t=document.createElement("button");t.textContent="Гарах",e.appendChild(t),t.addEventListener("click",()=>S());const o=document.createElement("h2");return o.textContent=`За юу байна, хөөрхөнөө ${n.username}`,e.appendChild(o),e},H=async()=>{const e=document.createElement("div");e.id="lists";const t=document.createElement("h2");t.textContent="Жагсаалтууд",e.appendChild(t);const o=document.createElement("div");o.classList.add("single-list");const r=document.createElement("p");r.textContent="Өнөөдрийн төлөвлөгөө",o.appendChild(r),e.appendChild(o),o.addEventListener("click",async()=>{document.querySelectorAll(".single-list").forEach(c=>c.classList.remove("selected")),o.classList.add("selected"),n.selectedList="myDay",await D()});const u=document.createElement("div");u.classList.add("single-list");const m=document.createElement("p");m.textContent="Төлөвлөсөн",u.appendChild(m),e.appendChild(u),u.addEventListener("click",async()=>{document.querySelectorAll(".single-list").forEach(c=>c.classList.remove("selected")),u.classList.add("selected"),n.selectedList="planned",await D()});const p=document.createElement("div");p.classList.add("single-list");const v=document.createElement("p");if(v.textContent="Бүгд",p.appendChild(v),e.appendChild(p),p.addEventListener("click",async()=>{document.querySelectorAll(".single-list").forEach(c=>c.classList.remove("selected")),p.classList.add("selected"),n.selectedList="all",await D()}),e.appendChild(document.createElement("hr")),n.lists.length===0){const d=document.createElement("p");d.textContent="You have no lists created, buddy",e.appendChild(d)}else n.lists.map(d=>{const c=document.createElement("div");c.classList.add("single-list");const w=document.createElement("p");w.textContent=d.title,c.appendChild(w),e.appendChild(c),c.addEventListener("click",async()=>{document.querySelectorAll(".single-list").forEach(g=>g.classList.remove("selected")),c.classList.add("selected"),n.selectedList=d,await D()}),c.addEventListener("contextmenu",f=>{const g=d._id;U(f,g)})});const l=document.createElement("input"),i=document.createElement("button");return i.innerText="Нэмэх",e.appendChild(l),e.appendChild(i),i.addEventListener("click",async()=>{if(l.value==="")console.log("HOOSON BAINA");else try{const d=await fetch(`${y}/list`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({title:l.value.trim()})});if(d.ok){const c=await d.json();console.log("List created successfully:",c),window.location.reload()}else console.error("Failed to create list")}catch(d){console.error("Error creating list:",d)}}),e},U=(e,t)=>{e.preventDefault(),s.style.display="block",s.style.left=`${e.pageX}px`,s.style.top=`${e.pageY}px`,document.addEventListener("click",x),document.getElementById("deleteListOption").addEventListener("click",()=>{L.style.display="block",O.addEventListener("click",()=>{console.log(`List ${t} deleted`),Y(t),L.style.display="none",s.style.display="none",document.removeEventListener("click",x),window.location.reload()}),k.addEventListener("click",()=>{L.style.display="none",s.style.display="none",document.removeEventListener("click",x)})})},x=()=>{s.style.display="none",document.removeEventListener("click",x)},Y=async e=>{try{(await fetch(`${y}/list/${e}`,{method:"DELETE",headers:{"Content-Type":"application/json"},credentials:"include"})).ok?console.log(`List ${e} deleted successfully`):console.error(`Failed to delete ${e}`)}catch(t){console.error("Error deleting a list:",t)}},D=async()=>{let e;const t=new Date().toLocaleDateString(),o=document.getElementById("todos");o.innerHTML="";const r=document.createElement("div");r.classList="container";const u=document.createElement("form");u.id="addTodoForm";const m=document.createElement("input");m.type="text",m.id="todoTitle",m.name="todoTitle",m.required=!0;const p=document.createElement("input");p.type="date",p.id="todoDate",p.name="todoDate";const v=document.createElement("button");if(v.innerText="Let's Roll",v.type="submit",u.appendChild(m),u.appendChild(p),u.appendChild(v),r.appendChild(u),o.appendChild(r),u.addEventListener("submit",async l=>{l.preventDefault(),console.log(m.value.trim()),console.log(p.value);let i={};i.todoTitle=m.value.trim(),i.date=p.value,typeof n.selectedList!="string"&&(i.listId=n.selectedList.listId),(await fetch(`${y}/todo`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(i)})).ok?(console.log("Added todo"),window.location.reload()):console.log("Error adding todo")}),typeof n.selectedList=="string"?n.selectedList==="myDay"?e=n.todos.filter(l=>new Date(l.date).toLocaleDateString()===t):n.selectedList==="planned"?e=n.todos.filter(l=>l.date!==null):n.selectedList==="all"?e=n.todos:console.log("No list"):e=n.todos.filter(l=>(console.log(n.selectedList.listId),l.listId===n.selectedList.listId)),e.length!==0)e.forEach(l=>{const i=document.createElement("div");i.classList.add("single-todo");const d=document.createElement("div"),c=document.createElement("h4"),w=document.createElement("p");c.textContent=l.todoTitle,w.textContent=l.date;const f=document.createElement("input");f.type="checkbox",f.checked=l.completed,d.appendChild(w),d.appendChild(f),i.appendChild(c),i.appendChild(d),o.appendChild(i),i.addEventListener("contextmenu",g=>{const C=l._id;J(g,C)}),f.addEventListener("change",async()=>{const g=!l.completed;console.log(g);try{const C=await fetch(`${y}/todo/completed/${l._id}`,{credentials:"include"});C.ok?(console.log(C),window.location.reload()):console.error("PUT request failed")}catch(C){console.error("Error making PUT request:",C)}await M()})}),console.log(e);else{const l=document.createElement("p");l.textContent="Юм алгадаа хөгшөөн",o.appendChild(l),console.log("YOu have no todos, buddy")}},J=(e,t)=>{e.preventDefault(),E.style.display="block",E.style.left=`${e.pageX}px`,E.style.top=`${e.pageY}px`,document.addEventListener("click",b),document.getElementById("deleteTodoOption").addEventListener("click",()=>{a.style.display="block",T.addEventListener("click",()=>{console.log(`Todo ${t} deleted`),_(t),a.style.display="none",E.style.display="none",document.removeEventListener("click",b),window.location.reload()}),B.addEventListener("click",()=>{a.style.display="none",E.style.display="none",document.removeEventListener("click",b)})})},b=()=>{E.style.display="none",document.removeEventListener("click",b)},M=async()=>{const e=document.createElement("div");e.id="todos";const t=document.createElement("h2");return t.textContent="Хийх зүйлс",e.appendChild(t),e},_=async e=>{try{(await fetch(`${y}/todo/${e}`,{method:"DELETE",headers:{"Content-Type":"application/json"},credentials:"include"})).ok?console.log(`Todo ${e} deleted successfully`):console.error(`Failed to delete ${e}`)}catch(t){console.error("Error deleting a todo:",t)}},X=async()=>{const e=document.createElement("div");e.id="details";const t=document.createElement("h2");return t.textContent="Дэлгэрэнгүй",e.appendChild(t),e};q()});
